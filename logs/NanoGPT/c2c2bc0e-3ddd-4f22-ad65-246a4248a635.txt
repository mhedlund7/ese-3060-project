====================================================================================================
EXPERIMENT METADATA
====================================================================================================
Run ID: c2c2bc0e-3ddd-4f22-ad65-246a4248a635
Start Time: 2025-12-09T17:36:19.709781
Random Seed: 3656818
DDP World Size: 8
====================================================================================================
HYPERPARAMETERS
====================================================================================================
input_bin: data/fineweb10B/fineweb_train_*.bin
input_val_bin: data/fineweb10B/fineweb_val_*.bin
batch_size: 512
device_batch_size: 64
sequence_length: 1024
num_iterations: 500
learning_rate: 0.0036
warmup_iters: 0
warmdown_iters: 150
weight_decay: 0
val_loss_every: 100
val_tokens: 2097152
save_every: 0
block_optimizer: adagrad
short_run: True
====================================================================================================
MODEL CONFIGURATION
====================================================================================================
Vocab Size: 50304
Layers: 12
Heads: 6
Embedding Dim: 768
====================================================================================================
OPTIMIZER CONFIGURATIONS
====================================================================================================
LM Head: AdamW, lr=0.0036, betas=(0.9, 0.95), wd=0
Transformer: adagrad, lr=0.00036, momentum=0.95, nesterov=True
====================================================================================================
TRAINING CODE
====================================================================================================
# NOTE: record from https://github.com/KellerJordan/modded-nanogpt/blob/master/records/track_1_short/2024-10-14_ModernArch/dabaaddd-237c-4ec9-939d-6608a9ed5e27.txt
# ====================================================================================================
import os
import sys
with open(sys.argv[0]) as f:
    code = f.read() # read the code of this file ASAP, for logging
import uuid
import glob
import time
import json
import random
import subprocess
from dataclasses import dataclass, asdict
from datetime import datetime

import numpy as np
import torch
from torch import nn
import torch.nn.functional as F
import torch.distributed as dist
import torch._inductor.config as config
from torch.nn.parallel import DistributedDataParallel as DDP

# Matplotlib for training curve plots
import matplotlib
matplotlib.use('Agg')
import matplotlib.pyplot as plt
HAS_MATPLOTLIB = True

# -----------------------------------------------------------------------------
# Muon optimizer

def zeropower_via_svd(G, steps=None):
    U, S, V = G.svd()
    return U @ V.T

@torch.compile
def zeropower_via_newtonschulz5(G, steps=10, eps=1e-7):
    """
    Newton-Schulz iteration to compute the zeroth power / orthogonalization of G. We opt to use a
    quintic iteration whose coefficients are selected to maximize the slope at zero. For the purpose
    of minimizing steps, it turns out to be empirically effective to keep increasing the slope at
    zero even beyond the point where the iteration no longer converges all the way to one everywhere
    on the interval. This iteration therefore does not produce UV^T but rather something like US'V^T
    where S' is diagonal with S_{ii}' \sim Uniform(0.5, 1.5), which turns out not to hurt model
    performance at all relative to UV^T, where USV^T = G is the SVD.
    """
    assert len(G.shape) == 2
    a, b, c = (3.4445, -4.7750,  2.0315)
    X = G.bfloat16()
    X /= (X.norm() + eps) # ensure top singular value <= 1
    if G.size(0) > G.size(1):
        X = X.T
    for _ in range(steps):
        A = X @ X.T
        B = A @ X
        X = a * X + b * B + c * A @ B
    if G.size(0) > G.size(1):
        X = X.T
    return X

zeropower_backends = dict(svd=zeropower_via_svd, newtonschulz5=zeropower_via_newtonschulz5)

class Muon(torch.optim.Optimizer):
    """
    Muon - MomentUm Orthogonalized by Newton-schulz

    Muon internally runs standard SGD-momentum, and then performs an orthogonalization post-
    processing step, in which each 2D parameter's update is replaced with the nearest orthogonal
    matrix. To efficiently orthogonalize each update, we use a Newton-Schulz iteration, which has
    the advantage that it can be stably run in bfloat16 on the GPU.

    Some warnings:
    - This optimizer assumes that all parameters passed in are 2D.
    - It should not be used for the embedding layer, the final fully connected layer, or any {0,1}-D
    parameters; those should all be optimized by a standard method (e.g., AdamW).
    - To use it with 4D convolutional filters, it works well to just flatten their last 3 dimensions.
    - We believe it is unlikely to work well for training with small batch size.
    - We believe it may not work well for finetuning pretrained models, but we haven't tested this.
    - We have not yet tried this optimizer for training scenarios larger than NanoGPT (124M).

    Arguments:
        lr: The learning rate used by the internal SGD.
        momentum: The momentum used by the internal SGD.
        nesterov: Whether to use Nesterov-style momentum in the internal SGD. (recommended)
        backend: The chosen backend for the orthogonalization step. (recommended: 'newtonschulz5')
        backend_steps: The number of iteration steps to use in the backend, if it is iterative.
    """
    def __init__(self, params, lr=3e-4, momentum=0.95, nesterov=True, backend='newtonschulz5', backend_steps=5):
        defaults = dict(lr=lr, momentum=momentum, nesterov=nesterov, backend=backend, backend_steps=backend_steps)
        super().__init__(params, defaults)

    def step(self):
        for group in self.param_groups:
            lr = group['lr']
            momentum = group['momentum']
            zeropower_backend = zeropower_backends[group['backend']]
            for p in group['params']:
                g = p.grad
                if g is None:
                    continue
                state = self.state[p]
                if 'momentum_buffer' not in state:
                    state['momentum_buffer'] = torch.zeros_like(g)
                buf = state['momentum_buffer']
                buf.mul_(momentum).add_(g)
                if group['nesterov']:
                    g = g.add(buf, alpha=momentum)
                if g.size(0) == 3 * g.size(1): # split grouped QKV parameters
                    g = torch.cat([zeropower_backend(g1, steps=group['backend_steps']) for g1 in g.split(g.size(1))])
                    scale = g.size(1)**0.5
                else:
                    g = zeropower_backend(g, steps=group['backend_steps'])
                    scale = max(g.size(0), g.size(1))**0.5 # scale to have update.square().mean() == 1
                p.data.add_(g, alpha=-lr * scale)

# -----------------------------------------------------------------------------
# PyTorch nn.Module definitions for the GPT-2 model

class Rotary(torch.nn.Module):

    def __init__(self, dim, base=10000):
        super().__init__()
        self.inv_freq = 1.0 / (base ** (torch.arange(0, dim, 2).float() / dim))
        self.seq_len_cached = None
        self.cos_cached = None
        self.sin_cached = None

    def forward(self, x):
        seq_len = x.shape[1]
        if seq_len != self.seq_len_cached:
            self.seq_len_cached = seq_len
            t = torch.arange(seq_len, device=x.device).type_as(self.inv_freq)
            freqs = torch.outer(t, self.inv_freq).to(x.device)
            self.cos_cached = freqs.cos().bfloat16()
            self.sin_cached = freqs.sin().bfloat16()
        return self.cos_cached[None, :, None, :], self.sin_cached[None, :, None, :]

def apply_rotary_emb(x, cos, sin):
    assert x.ndim == 4 # multihead attention
    d = x.shape[3]//2
    x1 = x[..., :d]
    x2 = x[..., d:]
    y1 = x1 * cos + x2 * sin
    y2 = x1 * (-sin) + x2 * cos
    return torch.cat([y1, y2], 3).type_as(x)

class CausalSelfAttention(nn.Module):

    def __init__(self, config):
        super().__init__()
        self.n_head = config.n_head
        self.n_embd = config.n_embd
        self.head_dim = self.n_embd // self.n_head
        assert self.n_embd % self.n_head == 0
        self.c_q = nn.Linear(self.n_embd, self.n_embd, bias=False)
        self.c_k = nn.Linear(self.n_embd, self.n_embd, bias=False)
        self.c_v = nn.Linear(self.n_embd, self.n_embd, bias=False)
        # output projection
        self.c_proj = nn.Linear(self.n_embd, self.n_embd, bias=False)
        self.c_proj.weight.data.zero_() # zero init suggested by @Grad62304977
        self.rotary = Rotary(self.head_dim)

    def forward(self, x):
        B, T, C = x.size() # batch size, sequence length, embedding dimensionality (n_embd)
        q = self.c_q(x).view(B, T, self.n_head, self.head_dim)
        k = self.c_k(x).view(B, T, self.n_head, self.head_dim)
        v = self.c_v(x).view(B, T, self.n_head, self.head_dim)
        cos, sin = self.rotary(q)
        q, k = apply_rotary_emb(q, cos, sin), apply_rotary_emb(k, cos, sin)
        q, k = F.rms_norm(q, (q.size(-1),)), F.rms_norm(k, (k.size(-1),)) # QK norm suggested by @Grad62304977
        y = F.scaled_dot_product_attention(q.transpose(1, 2), k.transpose(1, 2), v.transpose(1, 2), is_causal=True)
        y = y.transpose(1, 2).contiguous().view_as(x) # re-assemble all head outputs side by side
        y = self.c_proj(y)
        return y

class MLP(nn.Module):

    def __init__(self, config):
        super().__init__()
        self.c_fc    = nn.Linear(config.n_embd, 4 * config.n_embd, bias=False)
        self.c_proj  = nn.Linear(4 * config.n_embd, config.n_embd, bias=False)
        self.c_proj.weight.data.zero_() # zero init suggested by @Grad62304977

    def forward(self, x):
        x = self.c_fc(x)
        x = F.relu(x).square() # https://arxiv.org/abs/2109.08668v2; ~1-2% better than GELU; suggested by @SKYLINEZ007 and @Grad62304977
        x = self.c_proj(x)
        return x

class Block(nn.Module):

    def __init__(self, config):
        super().__init__()
        self.attn = CausalSelfAttention(config)
        self.mlp = MLP(config)

    def forward(self, x):
        x = x + self.attn(F.rms_norm(x, (x.size(-1),)))
        x = x + self.mlp(F.rms_norm(x, (x.size(-1),)))
        return x

# -----------------------------------------------------------------------------
# The main GPT-2 model

@dataclass
class GPTConfig:
    vocab_size : int = 50304
    n_layer : int = 12
    n_head : int = 6 # head dim 128 suggested by @Grad62304977
    n_embd : int = 768

class GPT(nn.Module):

    def __init__(self, config):
        super().__init__()
        self.config = config

        self.transformer = nn.ModuleDict(dict(
            wte = nn.Embedding(config.vocab_size, config.n_embd),
            h = nn.ModuleList([Block(config) for _ in range(config.n_layer)]),
        ))
        self.lm_head = nn.Linear(config.n_embd, config.vocab_size, bias=False)
        self.transformer.wte.weight = self.lm_head.weight # https://paperswithcode.com/method/weight-tying

    def forward(self, idx, targets=None, return_logits=True):

        # forward the GPT model itself
        x = self.transformer.wte(idx) # token embeddings of shape (b, t, n_embd)
        for block in self.transformer.h:
            x = block(x)
        x = F.rms_norm(x, (x.size(-1),))

        if targets is not None:
            # if we are given some desired targets also calculate the loss
            logits = self.lm_head(x)
            logits = logits.float() # use tf32/fp32 for logits
            loss = F.cross_entropy(logits.view(-1, logits.size(-1)), targets.view(-1), ignore_index=-1)
        else:
            # inference-time mini-optimization: only forward the lm_head on the very last position
            logits = self.lm_head(x[:, [-1], :]) # note: using list [-1] to preserve the time dim
            logits = logits.float() # use tf32/fp32 for logits
            loss = None

        # there are performance reasons why not returning logits is prudent, if not needed
        if not return_logits:
            logits = None

        return logits, loss

# -----------------------------------------------------------------------------
# Our own simple Distributed Data Loader

def _peek_data_shard(filename):
    # only reads the header, returns header data
    with open(filename, "rb") as f:
        # first read the header, which is 256 int32 integers (4 bytes each)
        header = np.frombuffer(f.read(256*4), dtype=np.int32)
    if header[0] != 20240520:
        print("ERROR: magic number mismatch in the data .bin file!")
        print("---> HINT: Are you passing in a correct file with --input_bin?")
        print("---> HINT: Dataset encoding changed recently, re-run data prepro or refer again to README")
        print("---> HINT: For example re-run: `python dev/data/tinyshakespeare.py`, then re-try")
        exit(1)
    assert header[1] == 1, "unsupported version"
    ntok = header[2] # number of tokens (claimed)
    return ntok # for now just return the number of tokens

def _load_data_shard(filename):
    with open(filename, "rb") as f:
        # first read the header, which is 256 int32 integers (4 bytes each)
        header = np.frombuffer(f.read(256*4), dtype=np.int32)
        assert header[0] == 20240520, "magic number mismatch in the data .bin file"
        assert header[1] == 1, "unsupported version"
        ntok = header[2] # number of tokens (claimed)
        # the rest of it are tokens, stored as uint16
        tokens = np.frombuffer(f.read(), dtype=np.uint16)
    assert len(tokens) == ntok, "number of tokens read does not match header?"
    return tokens

class DistributedDataLoader:
    def __init__(self, filename_pattern, B, T, process_rank, num_processes):
        self.process_rank = process_rank
        self.num_processes = num_processes
        self.B = B
        self.T = T

        # glob files that match the pattern
        self.files = sorted(glob.glob(filename_pattern))
        assert len(self.files) > 0, f"did not find any files that match the pattern {filename_pattern}"

        # load and validate all data shards, count number of tokens in total
        ntok_total = 0
        for fname in self.files:
            shard_ntok = _peek_data_shard(fname)
            assert shard_ntok >= num_processes * B * T + 1
            ntok_total += int(shard_ntok)
        self.ntok_total = ntok_total

        # kick things off
        self.reset()

    def reset(self):
        self.current_shard = 0
        self.current_position = self.process_rank * self.B * self.T
        self.tokens = _load_data_shard(self.files[self.current_shard])

    def advance(self): # advance to next data shard
        self.current_shard = (self.current_shard + 1) % len(self.files)
        self.current_position = self.process_rank * self.B * self.T
        self.tokens = _load_data_shard(self.files[self.current_shard])

    def next_batch(self):
        B = self.B
        T = self.T
        buf = self.tokens[self.current_position : self.current_position+B*T+1]
        buf = torch.tensor(buf.astype(np.int32), dtype=torch.long)
        x = (buf[:-1]).view(B, T) # inputs
        y = (buf[1:]).view(B, T) # targets
        # advance current position and load next shard if necessary
        self.current_position += B * T * self.num_processes
        if self.current_position + (B * T * self.num_processes + 1) > len(self.tokens):
            self.advance()
        return x.cuda(), y.cuda()

# -----------------------------------------------------------------------------
# int main

@dataclass
class Hyperparameters:
    # data hyperparams
    input_bin : str = 'data/fineweb10B/fineweb_train_*.bin' # input .bin to train on
    input_val_bin : str = 'data/fineweb10B/fineweb_val_*.bin' # input .bin to eval validation loss on
    # optimization hyperparams
    batch_size : int = 8*64 # batch size, in sequences, across all devices
    device_batch_size : int = 64 # batch size, in sequences, per device
    sequence_length : int = 1024 # sequence length, in tokens
    num_iterations : int = 5100 # number of iterations to run
    learning_rate : float = 0.0036
    warmup_iters : int = 0
    warmdown_iters : int = 1450 # number of iterations of linear warmup/warmdown for triangular or trapezoidal schedule
    weight_decay : float = 0
    # evaluation and logging hyperparams
    val_loss_every : int = 125 # every how many steps to evaluate val loss? 0 for only at the end
    val_tokens : int = 10485760 # how many tokens of validation data? it's important to keep this fixed for consistent comparisons
    save_every : int = 0 # every how many steps to save the checkpoint? 0 for only at the end
    #added fields
    block_optimizer : str = 'adagrad'
    short_run : bool = False
args = Hyperparameters()

args = Hyperparameters()

if os.getenv("SHORT_RUN", "0") == "1":
    args.short_run = True

# if short_run is enabled, shrink iterations & val_tokens proportionally
if args.short_run:
    # e.g., ~500 iterations instead of 5100, fewer val tokens
    print("Using short_run config, reducing num_iterations and val_tokens.")
    # scale down roughly by 10x
    args.num_iterations = 500
    args.warmdown_iters = 150  # keep warmdown inside num_iterations
    args.val_tokens = 2_097_152  # 2M tokens instead of 10M
    args.val_loss_every = 100


# set up DDP (distributed data parallel). torchrun sets this env variable
assert torch.cuda.is_available()
dist.init_process_group(backend='nccl')
ddp_rank = int(os.environ['RANK'])
ddp_local_rank = int(os.environ['LOCAL_RANK'])
ddp_world_size = int(os.environ['WORLD_SIZE'])
device = f'cuda:{ddp_local_rank}'
torch.cuda.set_device(device)
print(f"using device: {device}")
master_process = (ddp_rank == 0) # this process will do logging, checkpointing etc.

# Set random seeds for reproducibility
RANDOM_SEED = random.randint(0, 2**31 - 1)  # Generate a random seed, but log it
if master_process:
    print(f"Random seed: {RANDOM_SEED}")
torch.manual_seed(RANDOM_SEED)
torch.cuda.manual_seed_all(RANDOM_SEED)
np.random.seed(RANDOM_SEED)
random.seed(RANDOM_SEED)

# convenience variables
B, T = args.device_batch_size, args.sequence_length
# calculate the number of steps to take in the val loop.
assert args.val_tokens % (B * T * ddp_world_size) == 0
val_steps = args.val_tokens // (B * T * ddp_world_size)
# calculate the steps of gradient accumulation required to attain the desired global batch size.
assert args.batch_size % (B * ddp_world_size) == 0
train_accumulation_steps = args.batch_size // (B * ddp_world_size)

# load tokens
train_loader = DistributedDataLoader(args.input_bin, B, T, ddp_rank, ddp_world_size)
val_loader = DistributedDataLoader(args.input_val_bin, B, T, ddp_rank, ddp_world_size)
if master_process:
    print(f"Training DataLoader: total number of tokens: {train_loader.ntok_total} across {len(train_loader.files)} files")
    print(f"Validation DataLoader: total number of tokens: {val_loader.ntok_total} across {len(val_loader.files)} files")
x, y = train_loader.next_batch()

# there are only 50257 unique GPT-2 tokens; we extend to nearest multiple of 128 for efficiency. suggested to me by @Grad62304977.
# this originates from Karpathy's experiments.
num_vocab = 50304
model = GPT(GPTConfig(vocab_size=num_vocab, n_layer=12, n_head=6, n_embd=768))
model = model.cuda()
if hasattr(config, "coordinate_descent_tuning"):
    config.coordinate_descent_tuning = True # suggested by @Chillee
model = torch.compile(model)
# here we wrap model into DDP container
model = DDP(model, device_ids=[ddp_local_rank])
raw_model = model.module # always contains the "raw" unwrapped model
ctx = torch.amp.autocast(device_type='cuda', dtype=torch.bfloat16)

# init the optimizer(s)
optimizer1 = torch.optim.AdamW(raw_model.lm_head.parameters(), lr=args.learning_rate, betas=(0.9, 0.95),
weight_decay=args.weight_decay, fused=True,
)

#choose optimizer for transformer blocks
block_params = raw_model.transformer.h.parameters()

if args.block_optimizer.lower() == "muon":
    print("Using Muon optimizer for transformer blocks.")
    optimizer2 = Muon(block_params, lr=0.1 * args.learning_rate, momentum=0.95)
elif args.block_optimizer.lower() == "adagrad":
    print("Using Adagrad optimizer for transformer blocks.")
    # simple adagrad baseline, update lr later
    optimizer2 = torch.optim.Adagrad(block_params, lr=0.1 * args.learning_rate,
        weight_decay=args.weight_decay,
    )
else:
    raise ValueError(f"Unknown block_optimizer: {args.block_optimizer}")

optimizers = [optimizer1, optimizer2]

# learning rate decay scheduler (linear warmup and warmdown)
def get_lr(it):
    assert it <= args.num_iterations
    # 1) linear warmup for warmup_iters steps
    if it < args.warmup_iters:
        return (it+1) / args.warmup_iters
    # 2) constant lr for a while
    elif it < args.num_iterations - args.warmdown_iters:
        return 1.0
    # 3) linear warmdown
    else:
        decay_ratio = (args.num_iterations - it) / args.warmdown_iters
        return decay_ratio
schedulers = [torch.optim.lr_scheduler.LambdaLR(opt, get_lr) for opt in optimizers]

# begin logging
if master_process:
    run_id = str(uuid.uuid4())
    logdir = 'logs/NanoGPT/%s/' % run_id
    os.makedirs(logdir, exist_ok=True)
    logfile = 'logs/NanoGPT/%s.txt' % run_id
    json_logfile = 'logs/NanoGPT/%s.json' % run_id
    
    # Collect all metadata
    start_time = datetime.now().isoformat()
    
    # Collect training/validation data for statistics
    training_data = {
        'train_losses': [],
        'val_losses': [],
        'train_times': [],
        'steps': []
    }
    
    # Create comprehensive metadata log
    metadata = {
        'run_id': run_id,
        'start_time': start_time,
        'random_seed': RANDOM_SEED,
        'ddp_world_size': ddp_world_size,
        'hyperparameters': asdict(args),
        'model_config': {
            'vocab_size': num_vocab,
            'n_layer': 12,
            'n_head': 6,
            'n_embd': 768
        },
        'optimizer_configs': {
            'lm_head': {
                'type': 'AdamW',
                'lr': args.learning_rate,
                'betas': (0.9, 0.95),
                'weight_decay': args.weight_decay
            },
            'transformer': {
                'type': args.block_optimizer,
                'lr': 0.1 * args.learning_rate,
                'momentum': 0.95,
                'nesterov': True
            }
        }
    }
    
    # create the log file
    with open(logfile, "w") as f:
        # begin the log by printing this file (the Python code)
        f.write('='*100 + '\n')
        f.write('EXPERIMENT METADATA\n')
        f.write('='*100 + '\n')
        f.write(f"Run ID: {run_id}\n")
        f.write(f"Start Time: {start_time}\n")
        f.write(f"Random Seed: {RANDOM_SEED}\n")
        f.write(f"DDP World Size: {ddp_world_size}\n")
        f.write('='*100 + '\n')
        f.write('HYPERPARAMETERS\n')
        f.write('='*100 + '\n')
        for key, value in asdict(args).items():
            f.write(f"{key}: {value}\n")
        f.write('='*100 + '\n')
        f.write('MODEL CONFIGURATION\n')
        f.write('='*100 + '\n')
        f.write(f"Vocab Size: {num_vocab}\n")
        f.write(f"Layers: 12\n")
        f.write(f"Heads: 6\n")
        f.write(f"Embedding Dim: 768\n")
        f.write('='*100 + '\n')
        f.write('OPTIMIZER CONFIGURATIONS\n')
        f.write('='*100 + '\n')
        f.write(f"LM Head: AdamW, lr={args.learning_rate}, betas=(0.9, 0.95), wd={args.weight_decay}\n")
        f.write(f"Transformer: {args.block_optimizer}, lr={0.1*args.learning_rate}, momentum=0.95, nesterov=True\n")
        f.write('='*100 + '\n')
        f.write('TRAINING CODE\n')
        f.write('='*100 + '\n')
        f.write(code)
        f.write('='*100 + '\n')
        # log information about the hardware/software environment this is running on
        # and print the full `nvidia-smi` to file
        f.write(f"Running pytorch {torch.version.__version__} compiled for CUDA {torch.version.cuda}\nnvidia-smi:\n")
        result = subprocess.run(['nvidia-smi'], stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)
        f.write(f'{result.stdout}\n')
        f.write('TRAINING LOG\n')
        f.write('='*100 + '\n')
    
    # Save metadata to JSON
    with open(json_logfile, 'w') as f:
        json.dump(metadata, f, indent=2, default=str)

training_time_ms = 0
# start the clock
torch.cuda.synchronize()
t0 = time.time()
# begin training
train_loader.reset()
for step in range(args.num_iterations + 1):
    last_step = (step == args.num_iterations)
    # This effectively ignores timing first 10 steps, which are slower for weird reasons.
    # Alternately, and slightly more correctly in terms of benchmarking, we could do 10
    # steps with dummy data first, and then re-initialize the model and reset the loader.
    if step == 10:
        training_time_ms = 0
        t0 = time.time()
    timed_steps = float('nan') if step <= 11 else (step - 10) + 1 # <= 11 to avoid bug in val

    # once in a while evaluate the validation dataset
    if (last_step or (args.val_loss_every > 0 and step % args.val_loss_every == 0)):
        # stop the clock
        torch.cuda.synchronize()
        training_time_ms += 1000 * (time.time() - t0)
        # run validation batches
        model.eval()
        val_loader.reset()
        val_loss = 0.0
        for _ in range(val_steps):
            x_val, y_val = val_loader.next_batch()
            with ctx: # of course, we'd like to use no_grad() here too, but that creates a torch.compile error for some reason
                _, loss = model(x_val, y_val, return_logits=False)
                val_loss += loss.detach()
                del loss
        dist.all_reduce(val_loss, op=dist.ReduceOp.AVG)
        val_loss /= val_steps
        val_loss_value = float(val_loss.item())
        
        # Store validation data
        if master_process:
            training_data['val_losses'].append(val_loss_value)
            training_data['steps'].append(step)
            training_data['train_times'].append(training_time_ms)
        
        # log val loss to console and to logfile
        if master_process:
            step_avg = training_time_ms/(timed_steps-1) if timed_steps > 1 else 0
            log_line = f'step:{step}/{args.num_iterations} val_loss:{val_loss_value:.4f} train_time:{training_time_ms:.0f}ms step_avg:{step_avg:.2f}ms'
            print(log_line)
            with open(logfile, "a") as f:
                f.write(log_line + '\n')
        # start the clock again
        torch.cuda.synchronize()
        t0 = time.time()

    if master_process and (last_step or (args.save_every > 0 and step % args.save_every == 0)):
        # stop the clock
        torch.cuda.synchronize()
        training_time_ms += 1000 * (time.time() - t0)
        # save the state of the training process
        log = dict(step=step, code=code, model=raw_model.state_dict(), optimizers=[opt.state_dict() for opt in optimizers])
        torch.save(log, 'logs/NanoGPT/%s/state_step%06d.pt' % (run_id, step))
        # start the clock again
        torch.cuda.synchronize()
        t0 = time.time()

    # bit confusing: we want to make sure to eval on 0th iteration
    # but also after the very last iteration. so we loop for step <= num_iterations
    # instead of just < num_iterations (one extra due to <=), only to do
    # the validation/sampling one last time, and then we break right here as we're done.
    if last_step:
        break

    # --------------- TRAINING SECTION BEGIN -----------------
    model.train()
    for i in range(1, train_accumulation_steps+1):
        # forward pass
        with ctx:
            _, loss = model(x, y, return_logits=False)
            train_loss = loss.detach()
        # advance the dataset for the next batch
        x, y = train_loader.next_batch()
        # backward pass
        if i < train_accumulation_steps:
            with model.no_sync(): # there's no need to sync gradients every accumulation step
                loss.backward()
        else:
            loss.backward() # just sync on the last step
    for p in model.parameters():
        p.grad /= train_accumulation_steps
    # step the optimizers and schedulers
    for opt, sched in zip(optimizers, schedulers):
        opt.step()
        sched.step()
    # null the gradients
    model.zero_grad(set_to_none=True)
    # --------------- TRAINING SECTION END -------------------
    # everything that follows now is just diagnostics, prints, logging, etc.

    #dist.all_reduce(train_loss, op=dist.ReduceOp.AVG) # all-reducing the training loss would be more correct in terms of logging, but slower
    if master_process:
        train_loss_value = float(train_loss.item())
        approx_time = training_time_ms + 1000 * (time.time() - t0)
        
        # Store training data
        training_data['train_losses'].append(train_loss_value)
        
        step_avg = approx_time/timed_steps if timed_steps > 0 else 0
        log_line = f"step:{step+1}/{args.num_iterations} train_loss:{train_loss_value:.4f} train_time:{approx_time:.0f}ms step_avg:{step_avg:.2f}ms"
        print(log_line)
        with open(logfile, "a") as f:
            f.write(log_line + '\n')

if master_process:
    # Final statistics and logging
    peak_memory_mib = torch.cuda.max_memory_allocated() // 1024 // 1024
    
    # Get final values
    final_train_loss = float(training_data['train_losses'][-1]) if len(training_data['train_losses']) > 0 else None
    final_val_loss = float(training_data['val_losses'][-1]) if len(training_data['val_losses']) > 0 else None
    
    # Print final results
    print(f"\n{'='*100}")
    print("TRAINING COMPLETE")
    print(f"{'='*100}")
    print(f"Peak memory consumption: {peak_memory_mib} MiB")
    if final_train_loss is not None:
        print(f"Final training loss: {final_train_loss:.4f}")
    if final_val_loss is not None:
        print(f"Final validation loss: {final_val_loss:.4f}")
    print(f"Total training time: {training_time_ms:.0f} ms ({training_time_ms/1000:.2f} s)")
    
    # Write final results to log file
    with open(logfile, "a") as f:
        f.write(f"\n{'='*100}\n")
        f.write("FINAL RESULTS\n")
        f.write(f"{'='*100}\n")
        f.write(f"Peak memory consumption: {peak_memory_mib} MiB\n")
        if final_train_loss is not None:
            f.write(f"Final training loss: {final_train_loss:.4f}\n")
        if final_val_loss is not None:
            f.write(f"Final validation loss: {final_val_loss:.4f}\n")
        f.write(f"Total training time: {training_time_ms:.0f} ms ({training_time_ms/1000:.2f} s)\n")
    
    # Update JSON log with final results
    metadata['end_time'] = datetime.now().isoformat()
    metadata['training_time_ms'] = training_time_ms
    metadata['peak_memory_mib'] = peak_memory_mib
    if final_train_loss is not None:
        metadata['final_train_loss'] = final_train_loss
    if final_val_loss is not None:
        metadata['final_val_loss'] = final_val_loss
    metadata['training_data'] = {
        'train_losses': training_data['train_losses'],
        'val_losses': training_data['val_losses'],
        'train_times_ms': training_data['train_times'],
        'steps': training_data['steps']
    }
    
    with open(json_logfile, 'w') as f:
        json.dump(metadata, f, indent=2, default=str)
    
    # Generate training curves if matplotlib is available
    if HAS_MATPLOTLIB and len(training_data['train_losses']) > 0:
        try:
            fig, axes = plt.subplots(1, 2, figsize=(14, 5))
            
            # Plot training loss
            if len(training_data['train_losses']) > 0:
                steps_train = list(range(1, len(training_data['train_losses']) + 1))
                axes[0].plot(steps_train, training_data['train_losses'], 'b-', linewidth=1.5, label='Training Loss')
                axes[0].set_xlabel('Step')
                axes[0].set_ylabel('Loss')
                axes[0].set_title('Training Loss Curve')
                axes[0].legend()
                axes[0].grid(True, alpha=0.3)
            
            # Plot validation loss
            if len(training_data['val_losses']) > 0:
                axes[1].plot(training_data['steps'], training_data['val_losses'], 'r-', 
                           marker='o', markersize=3, linewidth=1.5, label='Validation Loss')
                axes[1].set_xlabel('Step')
                axes[1].set_ylabel('Loss')
                axes[1].set_title('Validation Loss Curve')
                axes[1].legend()
                axes[1].grid(True, alpha=0.3)
            
            plt.tight_layout()
            curve_path = f'{logdir}/training_curves.png'
            plt.savefig(curve_path, dpi=150, bbox_inches='tight')
            plt.close()
            print(f"\nðŸ“Š Training curves saved to: {os.path.abspath(curve_path)}")
        except Exception as e:
            print(f"Warning: Could not generate training curves: {e}")
    
    print(f"\nðŸ’¾ Logs saved to:")
    print(f"   Text: {os.path.abspath(logfile)}")
    print(f"   JSON: {os.path.abspath(json_logfile)}")
    print(f"{'='*100}\n")
====================================================================================================
Running pytorch 2.8.0+cu128 compiled for CUDA 12.8
nvidia-smi:
Tue Dec  9 17:36:19 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 570.195.03             Driver Version: 570.195.03     CUDA Version: 12.8     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA A100 80GB PCIe          On  |   00000000:00:07.0 Off |                    0 |
| N/A   54C    P0            147W /  300W |    2129MiB /  81920MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
|   1  NVIDIA A100 80GB PCIe          On  |   00000000:00:08.0 Off |                    0 |
| N/A   51C    P0             90W /  300W |    2129MiB /  81920MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
|   2  NVIDIA A100 80GB PCIe          On  |   00000000:00:09.0 Off |                    0 |
| N/A   55C    P0            125W /  300W |    2129MiB /  81920MiB |      9%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
|   3  NVIDIA A100 80GB PCIe          On  |   00000000:00:0A.0 Off |                    0 |
| N/A   53C    P0            100W /  300W |    2129MiB /  81920MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
|   4  NVIDIA A100 80GB PCIe          On  |   00000000:00:0B.0 Off |                    0 |
| N/A   50C    P0            138W /  300W |    2129MiB /  81920MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
|   5  NVIDIA A100 80GB PCIe          On  |   00000000:00:0C.0 Off |                    0 |
| N/A   46C    P0            101W /  300W |    2129MiB /  81920MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
|   6  NVIDIA A100 80GB PCIe          On  |   00000000:00:0D.0 Off |                    0 |
| N/A   46C    P0            130W /  300W |    2129MiB /  81920MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
|   7  NVIDIA A100 80GB PCIe          On  |   00000000:00:0E.0 Off |                    0 |
| N/A   47C    P0            115W /  300W |    2129MiB /  81920MiB |     12%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
+-----------------------------------------------------------------------------------------+

TRAINING LOG
====================================================================================================
step:0/500 val_loss:15.9863 train_time:274ms step_avg:0.00ms
step:1/500 train_loss:15.9772 train_time:65635ms step_avg:0.00ms
step:2/500 train_loss:9.7005 train_time:66013ms step_avg:0.00ms
step:3/500 train_loss:8.4022 train_time:66377ms step_avg:0.00ms
step:4/500 train_loss:8.0223 train_time:66744ms step_avg:0.00ms
step:5/500 train_loss:7.9608 train_time:67110ms step_avg:0.00ms
step:6/500 train_loss:7.9714 train_time:67476ms step_avg:0.00ms
step:7/500 train_loss:8.5092 train_time:67844ms step_avg:0.00ms
step:8/500 train_loss:9.7867 train_time:68209ms step_avg:0.00ms
step:9/500 train_loss:8.6575 train_time:68576ms step_avg:0.00ms
step:10/500 train_loss:8.0197 train_time:68943ms step_avg:0.00ms
step:11/500 train_loss:8.0869 train_time:366ms step_avg:0.00ms
step:12/500 train_loss:8.0798 train_time:733ms step_avg:0.00ms
step:13/500 train_loss:7.9530 train_time:1101ms step_avg:366.87ms
step:14/500 train_loss:8.1685 train_time:1467ms step_avg:366.72ms
step:15/500 train_loss:8.3328 train_time:1832ms step_avg:366.37ms
step:16/500 train_loss:7.9592 train_time:2199ms step_avg:366.52ms
step:17/500 train_loss:7.9341 train_time:2567ms step_avg:366.76ms
step:18/500 train_loss:7.9670 train_time:2935ms step_avg:366.90ms
step:19/500 train_loss:7.8631 train_time:3304ms step_avg:367.14ms
step:20/500 train_loss:7.8699 train_time:3673ms step_avg:367.30ms
step:21/500 train_loss:7.6135 train_time:4042ms step_avg:367.42ms
step:22/500 train_loss:7.9579 train_time:4408ms step_avg:367.37ms
step:23/500 train_loss:8.1529 train_time:4778ms step_avg:367.52ms
step:24/500 train_loss:7.8549 train_time:5147ms step_avg:367.67ms
step:25/500 train_loss:7.9154 train_time:5515ms step_avg:367.70ms
step:26/500 train_loss:7.7153 train_time:5884ms step_avg:367.78ms
step:27/500 train_loss:7.6096 train_time:6254ms step_avg:367.87ms
step:28/500 train_loss:7.8162 train_time:6623ms step_avg:367.96ms
step:29/500 train_loss:7.5572 train_time:6993ms step_avg:368.03ms
step:30/500 train_loss:7.8003 train_time:7360ms step_avg:368.02ms
step:31/500 train_loss:7.6588 train_time:7730ms step_avg:368.08ms
step:32/500 train_loss:7.5848 train_time:8098ms step_avg:368.10ms
step:33/500 train_loss:7.4146 train_time:8470ms step_avg:368.26ms
step:34/500 train_loss:7.8384 train_time:8839ms step_avg:368.29ms
step:35/500 train_loss:7.5810 train_time:9209ms step_avg:368.34ms
step:36/500 train_loss:7.7323 train_time:9579ms step_avg:368.43ms
step:37/500 train_loss:7.7219 train_time:9951ms step_avg:368.55ms
step:38/500 train_loss:7.6369 train_time:10322ms step_avg:368.64ms
step:39/500 train_loss:7.4496 train_time:10693ms step_avg:368.71ms
step:40/500 train_loss:7.5307 train_time:11064ms step_avg:368.81ms
step:41/500 train_loss:7.4303 train_time:11434ms step_avg:368.85ms
step:42/500 train_loss:7.4446 train_time:11806ms step_avg:368.93ms
step:43/500 train_loss:7.4014 train_time:12178ms step_avg:369.02ms
step:44/500 train_loss:7.3575 train_time:12551ms step_avg:369.13ms
step:45/500 train_loss:7.2912 train_time:12922ms step_avg:369.19ms
step:46/500 train_loss:7.4914 train_time:13293ms step_avg:369.24ms
step:47/500 train_loss:7.2978 train_time:13666ms step_avg:369.34ms
step:48/500 train_loss:7.2271 train_time:14039ms step_avg:369.45ms
step:49/500 train_loss:7.4892 train_time:14411ms step_avg:369.51ms
step:50/500 train_loss:7.3708 train_time:14783ms step_avg:369.57ms
step:51/500 train_loss:7.4340 train_time:15154ms step_avg:369.60ms
step:52/500 train_loss:7.2705 train_time:15526ms step_avg:369.66ms
step:53/500 train_loss:7.1164 train_time:15898ms step_avg:369.73ms
step:54/500 train_loss:7.2332 train_time:16270ms step_avg:369.78ms
step:55/500 train_loss:7.1968 train_time:16642ms step_avg:369.83ms
step:56/500 train_loss:7.5604 train_time:17015ms step_avg:369.90ms
step:57/500 train_loss:7.2622 train_time:17388ms step_avg:369.95ms
step:58/500 train_loss:7.1171 train_time:17760ms step_avg:370.00ms
step:59/500 train_loss:7.2040 train_time:18132ms step_avg:370.04ms
step:60/500 train_loss:7.0940 train_time:18504ms step_avg:370.08ms
step:61/500 train_loss:7.2358 train_time:18878ms step_avg:370.15ms
step:62/500 train_loss:7.0486 train_time:19250ms step_avg:370.20ms
step:63/500 train_loss:7.1202 train_time:19623ms step_avg:370.24ms
step:64/500 train_loss:7.0957 train_time:19996ms step_avg:370.30ms
step:65/500 train_loss:7.6019 train_time:20370ms step_avg:370.36ms
step:66/500 train_loss:6.9652 train_time:20743ms step_avg:370.40ms
step:67/500 train_loss:7.0729 train_time:21117ms step_avg:370.47ms
step:68/500 train_loss:6.9453 train_time:21490ms step_avg:370.52ms
step:69/500 train_loss:7.2637 train_time:21862ms step_avg:370.55ms
step:70/500 train_loss:6.8782 train_time:22236ms step_avg:370.59ms
step:71/500 train_loss:6.9027 train_time:22608ms step_avg:370.62ms
step:72/500 train_loss:7.1287 train_time:22980ms step_avg:370.64ms
step:73/500 train_loss:7.0210 train_time:23353ms step_avg:370.68ms
step:74/500 train_loss:6.9258 train_time:23725ms step_avg:370.71ms
step:75/500 train_loss:6.9966 train_time:24097ms step_avg:370.73ms
step:76/500 train_loss:7.0158 train_time:24470ms step_avg:370.76ms
step:77/500 train_loss:7.0092 train_time:24842ms step_avg:370.78ms
step:78/500 train_loss:7.0113 train_time:25214ms step_avg:370.79ms
step:79/500 train_loss:7.0907 train_time:25588ms step_avg:370.85ms
step:80/500 train_loss:7.0540 train_time:25962ms step_avg:370.89ms
step:81/500 train_loss:7.1192 train_time:26334ms step_avg:370.90ms
step:82/500 train_loss:6.8982 train_time:26706ms step_avg:370.92ms
step:83/500 train_loss:7.0836 train_time:27079ms step_avg:370.94ms
step:84/500 train_loss:6.9860 train_time:27452ms step_avg:370.97ms
step:85/500 train_loss:6.7829 train_time:27825ms step_avg:371.01ms
step:86/500 train_loss:6.6436 train_time:28198ms step_avg:371.03ms
step:87/500 train_loss:6.8583 train_time:28571ms step_avg:371.06ms
step:88/500 train_loss:6.7669 train_time:28944ms step_avg:371.07ms
step:89/500 train_loss:6.9586 train_time:29316ms step_avg:371.09ms
step:90/500 train_loss:6.8480 train_time:29689ms step_avg:371.12ms
step:91/500 train_loss:6.7507 train_time:30062ms step_avg:371.14ms
step:92/500 train_loss:6.7284 train_time:30435ms step_avg:371.16ms
step:93/500 train_loss:6.8841 train_time:30808ms step_avg:371.18ms
step:94/500 train_loss:6.7223 train_time:31182ms step_avg:371.22ms
step:95/500 train_loss:6.7028 train_time:31555ms step_avg:371.24ms
step:96/500 train_loss:6.7052 train_time:31928ms step_avg:371.26ms
step:97/500 train_loss:6.6148 train_time:32302ms step_avg:371.29ms
step:98/500 train_loss:6.7918 train_time:32677ms step_avg:371.33ms
step:99/500 train_loss:6.6040 train_time:33050ms step_avg:371.35ms
step:100/500 train_loss:6.7775 train_time:33422ms step_avg:371.36ms
step:100/500 val_loss:6.6858 train_time:33423ms step_avg:371.36ms
step:101/500 train_loss:6.7036 train_time:33798ms step_avg:371.40ms
step:102/500 train_loss:6.5959 train_time:34171ms step_avg:371.42ms
step:103/500 train_loss:6.7074 train_time:34544ms step_avg:371.45ms
step:104/500 train_loss:6.7644 train_time:34918ms step_avg:371.46ms
step:105/500 train_loss:6.5501 train_time:35290ms step_avg:371.48ms
step:106/500 train_loss:6.7248 train_time:35664ms step_avg:371.50ms
step:107/500 train_loss:6.9768 train_time:36037ms step_avg:371.51ms
step:108/500 train_loss:6.6844 train_time:36409ms step_avg:371.52ms
step:109/500 train_loss:6.3354 train_time:36783ms step_avg:371.54ms
step:110/500 train_loss:6.6351 train_time:37157ms step_avg:371.57ms
step:111/500 train_loss:6.6255 train_time:37528ms step_avg:371.56ms
step:112/500 train_loss:6.6347 train_time:37902ms step_avg:371.59ms
step:113/500 train_loss:6.6938 train_time:38275ms step_avg:371.60ms
step:114/500 train_loss:6.6501 train_time:38647ms step_avg:371.61ms
step:115/500 train_loss:6.4629 train_time:39021ms step_avg:371.63ms
step:116/500 train_loss:6.6698 train_time:39393ms step_avg:371.64ms
step:117/500 train_loss:6.4212 train_time:39768ms step_avg:371.66ms
step:118/500 train_loss:6.4838 train_time:40141ms step_avg:371.68ms
step:119/500 train_loss:6.5124 train_time:40515ms step_avg:371.69ms
step:120/500 train_loss:6.6467 train_time:40888ms step_avg:371.71ms
step:121/500 train_loss:6.5893 train_time:41261ms step_avg:371.72ms
step:122/500 train_loss:6.4665 train_time:41635ms step_avg:371.74ms
step:123/500 train_loss:6.4869 train_time:42009ms step_avg:371.76ms
step:124/500 train_loss:6.3718 train_time:42383ms step_avg:371.78ms
step:125/500 train_loss:6.6782 train_time:42757ms step_avg:371.80ms
step:126/500 train_loss:6.4564 train_time:43131ms step_avg:371.82ms
step:127/500 train_loss:6.5219 train_time:43505ms step_avg:371.84ms
step:128/500 train_loss:6.5834 train_time:43878ms step_avg:371.85ms
step:129/500 train_loss:6.4251 train_time:44252ms step_avg:371.86ms
step:130/500 train_loss:6.6731 train_time:44624ms step_avg:371.87ms
step:131/500 train_loss:6.5051 train_time:44999ms step_avg:371.89ms
step:132/500 train_loss:6.6026 train_time:45373ms step_avg:371.91ms
step:133/500 train_loss:6.4598 train_time:45746ms step_avg:371.92ms
step:134/500 train_loss:6.5345 train_time:46119ms step_avg:371.92ms
step:135/500 train_loss:6.5566 train_time:46494ms step_avg:371.95ms
step:136/500 train_loss:6.5190 train_time:46866ms step_avg:371.95ms
step:137/500 train_loss:6.3705 train_time:47240ms step_avg:371.97ms
step:138/500 train_loss:6.4218 train_time:47614ms step_avg:371.98ms
step:139/500 train_loss:6.4322 train_time:47987ms step_avg:371.99ms
step:140/500 train_loss:6.4681 train_time:48362ms step_avg:372.01ms
step:141/500 train_loss:6.3815 train_time:48735ms step_avg:372.03ms
step:142/500 train_loss:6.3587 train_time:49109ms step_avg:372.04ms
step:143/500 train_loss:6.4835 train_time:49483ms step_avg:372.05ms
step:144/500 train_loss:6.2081 train_time:49856ms step_avg:372.06ms
step:145/500 train_loss:6.4248 train_time:50230ms step_avg:372.07ms
step:146/500 train_loss:6.3629 train_time:50603ms step_avg:372.08ms
step:147/500 train_loss:6.3784 train_time:50976ms step_avg:372.09ms
step:148/500 train_loss:6.3982 train_time:51351ms step_avg:372.11ms
step:149/500 train_loss:6.4026 train_time:51725ms step_avg:372.12ms
step:150/500 train_loss:6.5365 train_time:52098ms step_avg:372.13ms
step:151/500 train_loss:6.5153 train_time:52472ms step_avg:372.14ms
step:152/500 train_loss:6.4240 train_time:52845ms step_avg:372.15ms
step:153/500 train_loss:6.3647 train_time:53218ms step_avg:372.16ms
step:154/500 train_loss:6.3780 train_time:53592ms step_avg:372.17ms
step:155/500 train_loss:6.3452 train_time:53966ms step_avg:372.18ms
step:156/500 train_loss:6.4555 train_time:54339ms step_avg:372.19ms
step:157/500 train_loss:6.3876 train_time:54713ms step_avg:372.20ms
step:158/500 train_loss:6.5333 train_time:55086ms step_avg:372.21ms
step:159/500 train_loss:6.2718 train_time:55461ms step_avg:372.22ms
step:160/500 train_loss:6.3115 train_time:55833ms step_avg:372.22ms
step:161/500 train_loss:6.2216 train_time:56206ms step_avg:372.23ms
step:162/500 train_loss:6.2724 train_time:56580ms step_avg:372.24ms
step:163/500 train_loss:6.3921 train_time:56954ms step_avg:372.25ms
step:164/500 train_loss:6.4228 train_time:57327ms step_avg:372.25ms
step:165/500 train_loss:6.2652 train_time:57701ms step_avg:372.26ms
step:166/500 train_loss:6.3488 train_time:58074ms step_avg:372.27ms
step:167/500 train_loss:6.4828 train_time:58447ms step_avg:372.27ms
step:168/500 train_loss:6.2676 train_time:58820ms step_avg:372.28ms
step:169/500 train_loss:6.3068 train_time:59194ms step_avg:372.29ms
step:170/500 train_loss:6.2345 train_time:59567ms step_avg:372.29ms
step:171/500 train_loss:6.3103 train_time:59939ms step_avg:372.29ms
step:172/500 train_loss:6.2841 train_time:60313ms step_avg:372.30ms
step:173/500 train_loss:6.2501 train_time:60686ms step_avg:372.31ms
step:174/500 train_loss:6.3360 train_time:61062ms step_avg:372.33ms
step:175/500 train_loss:6.4024 train_time:61434ms step_avg:372.33ms
step:176/500 train_loss:6.3635 train_time:61808ms step_avg:372.34ms
step:177/500 train_loss:6.1801 train_time:62182ms step_avg:372.34ms
step:178/500 train_loss:6.1565 train_time:62555ms step_avg:372.35ms
step:179/500 train_loss:6.1142 train_time:62928ms step_avg:372.36ms
step:180/500 train_loss:6.2508 train_time:63302ms step_avg:372.36ms
step:181/500 train_loss:6.1946 train_time:63675ms step_avg:372.37ms
step:182/500 train_loss:6.2587 train_time:64048ms step_avg:372.37ms
step:183/500 train_loss:6.2558 train_time:64422ms step_avg:372.38ms
step:184/500 train_loss:6.2163 train_time:64794ms step_avg:372.38ms
step:185/500 train_loss:6.2136 train_time:65169ms step_avg:372.39ms
step:186/500 train_loss:6.3462 train_time:65542ms step_avg:372.40ms
step:187/500 train_loss:6.1330 train_time:65915ms step_avg:372.40ms
step:188/500 train_loss:6.5073 train_time:66289ms step_avg:372.41ms
step:189/500 train_loss:6.2206 train_time:66664ms step_avg:372.42ms
step:190/500 train_loss:6.1626 train_time:67168ms step_avg:373.16ms
step:191/500 train_loss:6.3217 train_time:67541ms step_avg:373.16ms
step:192/500 train_loss:6.0869 train_time:67917ms step_avg:373.17ms
step:193/500 train_loss:6.1101 train_time:68293ms step_avg:373.19ms
step:194/500 train_loss:6.2127 train_time:68667ms step_avg:373.19ms
step:195/500 train_loss:6.2019 train_time:69039ms step_avg:373.18ms
step:196/500 train_loss:6.3929 train_time:69412ms step_avg:373.18ms
step:197/500 train_loss:6.2531 train_time:69786ms step_avg:373.19ms
step:198/500 train_loss:6.1104 train_time:70161ms step_avg:373.20ms
step:199/500 train_loss:6.1308 train_time:70535ms step_avg:373.20ms
step:200/500 train_loss:6.0555 train_time:70909ms step_avg:373.21ms
step:200/500 val_loss:6.1599 train_time:70910ms step_avg:373.21ms
step:201/500 train_loss:6.1462 train_time:71285ms step_avg:373.22ms
step:202/500 train_loss:6.0939 train_time:71661ms step_avg:373.23ms
step:203/500 train_loss:6.2112 train_time:72034ms step_avg:373.23ms
step:204/500 train_loss:6.2230 train_time:72408ms step_avg:373.24ms
step:205/500 train_loss:6.0777 train_time:72781ms step_avg:373.24ms
step:206/500 train_loss:6.2668 train_time:73154ms step_avg:373.24ms
step:207/500 train_loss:5.9593 train_time:73529ms step_avg:373.24ms
step:208/500 train_loss:6.0947 train_time:73902ms step_avg:373.24ms
step:209/500 train_loss:6.0778 train_time:74276ms step_avg:373.25ms
step:210/500 train_loss:6.2408 train_time:74650ms step_avg:373.25ms
step:211/500 train_loss:6.0591 train_time:75024ms step_avg:373.25ms
step:212/500 train_loss:6.0435 train_time:75397ms step_avg:373.25ms
step:213/500 train_loss:6.3425 train_time:75770ms step_avg:373.25ms
step:214/500 train_loss:6.0894 train_time:76145ms step_avg:373.26ms
step:215/500 train_loss:6.2002 train_time:76518ms step_avg:373.26ms
step:216/500 train_loss:6.0460 train_time:76891ms step_avg:373.26ms
step:217/500 train_loss:6.1680 train_time:77266ms step_avg:373.26ms
step:218/500 train_loss:6.0893 train_time:77638ms step_avg:373.26ms
step:219/500 train_loss:5.9721 train_time:78012ms step_avg:373.26ms
step:220/500 train_loss:6.0406 train_time:78385ms step_avg:373.26ms
step:221/500 train_loss:6.0313 train_time:78758ms step_avg:373.26ms
step:222/500 train_loss:6.1675 train_time:79132ms step_avg:373.26ms
step:223/500 train_loss:6.1745 train_time:79505ms step_avg:373.26ms
step:224/500 train_loss:6.1634 train_time:79878ms step_avg:373.26ms
step:225/500 train_loss:6.1106 train_time:80253ms step_avg:373.27ms
step:226/500 train_loss:5.7792 train_time:80625ms step_avg:373.26ms
step:227/500 train_loss:5.9595 train_time:80999ms step_avg:373.27ms
step:228/500 train_loss:5.9096 train_time:81373ms step_avg:373.27ms
step:229/500 train_loss:6.0674 train_time:81746ms step_avg:373.27ms
step:230/500 train_loss:5.9804 train_time:82120ms step_avg:373.27ms
step:231/500 train_loss:6.1255 train_time:82494ms step_avg:373.28ms
step:232/500 train_loss:6.0039 train_time:82869ms step_avg:373.28ms
step:233/500 train_loss:5.8485 train_time:83242ms step_avg:373.28ms
step:234/500 train_loss:6.1030 train_time:83615ms step_avg:373.28ms
step:235/500 train_loss:5.9393 train_time:83989ms step_avg:373.29ms
step:236/500 train_loss:5.7936 train_time:84363ms step_avg:373.29ms
step:237/500 train_loss:6.1800 train_time:84736ms step_avg:373.29ms
step:238/500 train_loss:6.0257 train_time:85110ms step_avg:373.29ms
step:239/500 train_loss:5.9911 train_time:85483ms step_avg:373.29ms
step:240/500 train_loss:6.1224 train_time:85856ms step_avg:373.29ms
step:241/500 train_loss:6.1859 train_time:86228ms step_avg:373.28ms
step:242/500 train_loss:6.0827 train_time:86601ms step_avg:373.28ms
step:243/500 train_loss:6.1557 train_time:86975ms step_avg:373.28ms
step:244/500 train_loss:5.9295 train_time:87348ms step_avg:373.28ms
step:245/500 train_loss:5.8776 train_time:87723ms step_avg:373.29ms
step:246/500 train_loss:5.9707 train_time:88097ms step_avg:373.29ms
step:247/500 train_loss:5.9510 train_time:88470ms step_avg:373.29ms
step:248/500 train_loss:5.9446 train_time:88843ms step_avg:373.29ms
step:249/500 train_loss:6.1683 train_time:89217ms step_avg:373.29ms
step:250/500 train_loss:5.8582 train_time:89590ms step_avg:373.29ms
step:251/500 train_loss:5.8499 train_time:89964ms step_avg:373.29ms
step:252/500 train_loss:5.9817 train_time:90338ms step_avg:373.30ms
step:253/500 train_loss:5.8714 train_time:90711ms step_avg:373.29ms
step:254/500 train_loss:5.9020 train_time:91085ms step_avg:373.30ms
step:255/500 train_loss:5.8958 train_time:91457ms step_avg:373.30ms
step:256/500 train_loss:5.9876 train_time:91831ms step_avg:373.30ms
step:257/500 train_loss:6.0680 train_time:92205ms step_avg:373.30ms
step:258/500 train_loss:5.9805 train_time:92578ms step_avg:373.30ms
step:259/500 train_loss:5.8563 train_time:92952ms step_avg:373.30ms
step:260/500 train_loss:5.8720 train_time:93326ms step_avg:373.30ms
step:261/500 train_loss:5.8903 train_time:93699ms step_avg:373.30ms
step:262/500 train_loss:5.9431 train_time:94073ms step_avg:373.30ms
step:263/500 train_loss:5.8835 train_time:94446ms step_avg:373.30ms
step:264/500 train_loss:5.9047 train_time:94820ms step_avg:373.31ms
step:265/500 train_loss:5.8721 train_time:95193ms step_avg:373.31ms
step:266/500 train_loss:5.7109 train_time:95567ms step_avg:373.31ms
step:267/500 train_loss:5.7967 train_time:95941ms step_avg:373.31ms
step:268/500 train_loss:5.8618 train_time:96313ms step_avg:373.31ms
step:269/500 train_loss:5.7084 train_time:96687ms step_avg:373.31ms
step:270/500 train_loss:5.8041 train_time:97060ms step_avg:373.31ms
step:271/500 train_loss:5.9648 train_time:97432ms step_avg:373.30ms
step:272/500 train_loss:5.9080 train_time:97807ms step_avg:373.31ms
step:273/500 train_loss:5.6987 train_time:98179ms step_avg:373.30ms
step:274/500 train_loss:5.7813 train_time:98552ms step_avg:373.30ms
step:275/500 train_loss:5.9603 train_time:98925ms step_avg:373.30ms
step:276/500 train_loss:5.9055 train_time:99300ms step_avg:373.31ms
step:277/500 train_loss:6.1143 train_time:99674ms step_avg:373.31ms
step:278/500 train_loss:5.8248 train_time:100046ms step_avg:373.31ms
step:279/500 train_loss:6.0451 train_time:100420ms step_avg:373.31ms
step:280/500 train_loss:5.8205 train_time:100794ms step_avg:373.31ms
step:281/500 train_loss:5.6737 train_time:101168ms step_avg:373.31ms
step:282/500 train_loss:5.7901 train_time:101540ms step_avg:373.31ms
step:283/500 train_loss:6.0436 train_time:101914ms step_avg:373.31ms
step:284/500 train_loss:5.7731 train_time:102287ms step_avg:373.31ms
step:285/500 train_loss:5.9065 train_time:102662ms step_avg:373.32ms
step:286/500 train_loss:5.8544 train_time:103036ms step_avg:373.32ms
step:287/500 train_loss:5.9014 train_time:103408ms step_avg:373.31ms
step:288/500 train_loss:5.8269 train_time:103783ms step_avg:373.32ms
step:289/500 train_loss:5.8585 train_time:104155ms step_avg:373.32ms
step:290/500 train_loss:5.6975 train_time:104528ms step_avg:373.31ms
step:291/500 train_loss:5.7428 train_time:104901ms step_avg:373.31ms
step:292/500 train_loss:5.8747 train_time:105274ms step_avg:373.31ms
step:293/500 train_loss:5.7336 train_time:105647ms step_avg:373.31ms
step:294/500 train_loss:5.7941 train_time:106022ms step_avg:373.32ms
step:295/500 train_loss:5.7571 train_time:106395ms step_avg:373.32ms
step:296/500 train_loss:5.6600 train_time:106769ms step_avg:373.32ms
step:297/500 train_loss:5.5764 train_time:107143ms step_avg:373.32ms
step:298/500 train_loss:5.6390 train_time:107516ms step_avg:373.32ms
step:299/500 train_loss:5.7404 train_time:107889ms step_avg:373.32ms
step:300/500 train_loss:5.6781 train_time:108263ms step_avg:373.32ms
step:300/500 val_loss:5.8064 train_time:108263ms step_avg:373.32ms
step:301/500 train_loss:5.8690 train_time:108638ms step_avg:373.33ms
step:302/500 train_loss:5.7969 train_time:109011ms step_avg:373.32ms
step:303/500 train_loss:5.7183 train_time:109384ms step_avg:373.32ms
step:304/500 train_loss:5.7951 train_time:109756ms step_avg:373.32ms
step:305/500 train_loss:5.8212 train_time:110129ms step_avg:373.32ms
step:306/500 train_loss:6.1645 train_time:110502ms step_avg:373.32ms
step:307/500 train_loss:5.7497 train_time:110876ms step_avg:373.32ms
step:308/500 train_loss:5.6820 train_time:111250ms step_avg:373.32ms
step:309/500 train_loss:5.8759 train_time:111622ms step_avg:373.32ms
step:310/500 train_loss:5.6290 train_time:111995ms step_avg:373.32ms
step:311/500 train_loss:5.8704 train_time:112369ms step_avg:373.32ms
step:312/500 train_loss:5.8321 train_time:112742ms step_avg:373.32ms
step:313/500 train_loss:5.7195 train_time:113116ms step_avg:373.32ms
step:314/500 train_loss:5.8814 train_time:113488ms step_avg:373.32ms
step:315/500 train_loss:5.9275 train_time:113861ms step_avg:373.31ms
step:316/500 train_loss:5.8140 train_time:114234ms step_avg:373.31ms
step:317/500 train_loss:5.7457 train_time:114607ms step_avg:373.31ms
step:318/500 train_loss:5.6850 train_time:114980ms step_avg:373.31ms
step:319/500 train_loss:5.6160 train_time:115353ms step_avg:373.31ms
step:320/500 train_loss:5.5860 train_time:115726ms step_avg:373.31ms
step:321/500 train_loss:5.6061 train_time:116099ms step_avg:373.31ms
step:322/500 train_loss:5.7152 train_time:116472ms step_avg:373.31ms
step:323/500 train_loss:5.6158 train_time:116845ms step_avg:373.31ms
step:324/500 train_loss:5.7586 train_time:117219ms step_avg:373.31ms
step:325/500 train_loss:5.8582 train_time:117592ms step_avg:373.31ms
step:326/500 train_loss:5.8231 train_time:117967ms step_avg:373.31ms
step:327/500 train_loss:5.6750 train_time:118339ms step_avg:373.31ms
step:328/500 train_loss:6.1139 train_time:118711ms step_avg:373.30ms
step:329/500 train_loss:5.8496 train_time:119085ms step_avg:373.31ms
step:330/500 train_loss:5.6532 train_time:119457ms step_avg:373.30ms
step:331/500 train_loss:5.6926 train_time:119830ms step_avg:373.30ms
step:332/500 train_loss:5.6888 train_time:120202ms step_avg:373.30ms
step:333/500 train_loss:5.6046 train_time:120576ms step_avg:373.30ms
step:334/500 train_loss:5.6953 train_time:120950ms step_avg:373.30ms
step:335/500 train_loss:5.6104 train_time:121323ms step_avg:373.30ms
step:336/500 train_loss:5.8126 train_time:121695ms step_avg:373.30ms
step:337/500 train_loss:5.7426 train_time:122069ms step_avg:373.30ms
step:338/500 train_loss:6.1805 train_time:122442ms step_avg:373.30ms
step:339/500 train_loss:5.7039 train_time:122814ms step_avg:373.30ms
step:340/500 train_loss:5.7276 train_time:123187ms step_avg:373.29ms
step:341/500 train_loss:5.6233 train_time:123560ms step_avg:373.29ms
step:342/500 train_loss:5.6040 train_time:123933ms step_avg:373.29ms
step:343/500 train_loss:5.5870 train_time:124305ms step_avg:373.29ms
step:344/500 train_loss:5.6974 train_time:124679ms step_avg:373.29ms
step:345/500 train_loss:5.7193 train_time:125052ms step_avg:373.29ms
step:346/500 train_loss:5.6732 train_time:125426ms step_avg:373.29ms
step:347/500 train_loss:5.6235 train_time:125799ms step_avg:373.29ms
step:348/500 train_loss:5.6721 train_time:126171ms step_avg:373.29ms
step:349/500 train_loss:5.6208 train_time:126545ms step_avg:373.29ms
step:350/500 train_loss:5.5212 train_time:126918ms step_avg:373.29ms
step:351/500 train_loss:5.1935 train_time:127290ms step_avg:373.28ms
step:352/500 train_loss:5.5317 train_time:127663ms step_avg:373.28ms
step:353/500 train_loss:5.8918 train_time:128036ms step_avg:373.28ms
step:354/500 train_loss:5.4845 train_time:128409ms step_avg:373.28ms
step:355/500 train_loss:5.6103 train_time:128782ms step_avg:373.28ms
step:356/500 train_loss:5.6159 train_time:129157ms step_avg:373.29ms
step:357/500 train_loss:5.6258 train_time:129530ms step_avg:373.29ms
step:358/500 train_loss:5.8012 train_time:129903ms step_avg:373.29ms
step:359/500 train_loss:5.5528 train_time:130275ms step_avg:373.28ms
step:360/500 train_loss:5.9554 train_time:130648ms step_avg:373.28ms
step:361/500 train_loss:5.3544 train_time:131023ms step_avg:373.28ms
step:362/500 train_loss:5.7135 train_time:131396ms step_avg:373.28ms
step:363/500 train_loss:5.7022 train_time:131770ms step_avg:373.29ms
step:364/500 train_loss:5.5185 train_time:132144ms step_avg:373.29ms
step:365/500 train_loss:5.5084 train_time:132518ms step_avg:373.29ms
step:366/500 train_loss:5.6194 train_time:132891ms step_avg:373.29ms
step:367/500 train_loss:5.5415 train_time:133263ms step_avg:373.29ms
step:368/500 train_loss:5.5516 train_time:133637ms step_avg:373.29ms
step:369/500 train_loss:5.5542 train_time:134009ms step_avg:373.28ms
step:370/500 train_loss:5.4513 train_time:134382ms step_avg:373.28ms
step:371/500 train_loss:5.5423 train_time:134756ms step_avg:373.29ms
step:372/500 train_loss:5.6394 train_time:135130ms step_avg:373.29ms
step:373/500 train_loss:5.3799 train_time:135504ms step_avg:373.29ms
step:374/500 train_loss:5.5333 train_time:135877ms step_avg:373.29ms
step:375/500 train_loss:5.5118 train_time:136250ms step_avg:373.29ms
step:376/500 train_loss:5.4936 train_time:136624ms step_avg:373.29ms
step:377/500 train_loss:5.5632 train_time:136998ms step_avg:373.29ms
step:378/500 train_loss:5.3958 train_time:137371ms step_avg:373.29ms
step:379/500 train_loss:5.5121 train_time:137744ms step_avg:373.29ms
step:380/500 train_loss:5.6341 train_time:138235ms step_avg:373.61ms
step:381/500 train_loss:5.6117 train_time:138608ms step_avg:373.61ms
step:382/500 train_loss:5.6197 train_time:138981ms step_avg:373.60ms
step:383/500 train_loss:5.6556 train_time:139357ms step_avg:373.61ms
step:384/500 train_loss:5.3953 train_time:139729ms step_avg:373.61ms
step:385/500 train_loss:5.5095 train_time:140101ms step_avg:373.60ms
step:386/500 train_loss:5.4474 train_time:140475ms step_avg:373.60ms
step:387/500 train_loss:5.5894 train_time:140849ms step_avg:373.60ms
step:388/500 train_loss:5.7685 train_time:141222ms step_avg:373.60ms
step:389/500 train_loss:5.4612 train_time:141595ms step_avg:373.60ms
step:390/500 train_loss:5.3582 train_time:141969ms step_avg:373.60ms
step:391/500 train_loss:5.5321 train_time:142342ms step_avg:373.60ms
step:392/500 train_loss:5.4437 train_time:142716ms step_avg:373.60ms
step:393/500 train_loss:5.5409 train_time:143090ms step_avg:373.60ms
step:394/500 train_loss:5.3753 train_time:143461ms step_avg:373.60ms
step:395/500 train_loss:5.4781 train_time:143835ms step_avg:373.60ms
step:396/500 train_loss:5.3950 train_time:144208ms step_avg:373.60ms
step:397/500 train_loss:5.4007 train_time:144581ms step_avg:373.59ms
step:398/500 train_loss:5.6302 train_time:144954ms step_avg:373.59ms
step:399/500 train_loss:5.4973 train_time:145328ms step_avg:373.59ms
step:400/500 train_loss:5.4336 train_time:145703ms step_avg:373.60ms
step:400/500 val_loss:5.4806 train_time:145703ms step_avg:373.60ms
step:401/500 train_loss:5.5296 train_time:146079ms step_avg:373.60ms
step:402/500 train_loss:5.4728 train_time:146452ms step_avg:373.60ms
step:403/500 train_loss:5.4786 train_time:146824ms step_avg:373.60ms
step:404/500 train_loss:5.5549 train_time:147198ms step_avg:373.60ms
step:405/500 train_loss:5.4969 train_time:147571ms step_avg:373.60ms
step:406/500 train_loss:5.3936 train_time:147943ms step_avg:373.59ms
step:407/500 train_loss:5.6426 train_time:148316ms step_avg:373.59ms
step:408/500 train_loss:5.4583 train_time:148689ms step_avg:373.59ms
step:409/500 train_loss:5.4415 train_time:149063ms step_avg:373.59ms
step:410/500 train_loss:5.4792 train_time:149437ms step_avg:373.59ms
step:411/500 train_loss:5.3657 train_time:149809ms step_avg:373.59ms
step:412/500 train_loss:5.4311 train_time:150183ms step_avg:373.59ms
step:413/500 train_loss:5.7806 train_time:150555ms step_avg:373.59ms
step:414/500 train_loss:5.2937 train_time:150929ms step_avg:373.59ms
step:415/500 train_loss:5.5922 train_time:151303ms step_avg:373.59ms
step:416/500 train_loss:5.3737 train_time:151676ms step_avg:373.59ms
step:417/500 train_loss:5.3799 train_time:152049ms step_avg:373.58ms
step:418/500 train_loss:5.4976 train_time:152421ms step_avg:373.58ms
step:419/500 train_loss:5.2997 train_time:152795ms step_avg:373.58ms
step:420/500 train_loss:5.3531 train_time:153169ms step_avg:373.58ms
step:421/500 train_loss:5.4397 train_time:153542ms step_avg:373.58ms
step:422/500 train_loss:5.2334 train_time:153914ms step_avg:373.58ms
step:423/500 train_loss:5.2880 train_time:154289ms step_avg:373.58ms
step:424/500 train_loss:5.4203 train_time:154663ms step_avg:373.58ms
step:425/500 train_loss:5.3259 train_time:155037ms step_avg:373.58ms
step:426/500 train_loss:5.4596 train_time:155411ms step_avg:373.58ms
step:427/500 train_loss:5.3281 train_time:155784ms step_avg:373.58ms
step:428/500 train_loss:5.4785 train_time:156158ms step_avg:373.58ms
step:429/500 train_loss:5.4561 train_time:156530ms step_avg:373.58ms
step:430/500 train_loss:5.3032 train_time:156903ms step_avg:373.58ms
step:431/500 train_loss:5.3199 train_time:157276ms step_avg:373.58ms
step:432/500 train_loss:5.4180 train_time:157650ms step_avg:373.58ms
step:433/500 train_loss:5.3422 train_time:158025ms step_avg:373.58ms
step:434/500 train_loss:5.4305 train_time:158398ms step_avg:373.58ms
step:435/500 train_loss:5.3690 train_time:158771ms step_avg:373.58ms
step:436/500 train_loss:5.3784 train_time:159144ms step_avg:373.58ms
step:437/500 train_loss:5.3839 train_time:159518ms step_avg:373.58ms
step:438/500 train_loss:5.3197 train_time:159892ms step_avg:373.58ms
step:439/500 train_loss:5.3352 train_time:160266ms step_avg:373.58ms
step:440/500 train_loss:5.2182 train_time:160638ms step_avg:373.58ms
step:441/500 train_loss:5.4522 train_time:161011ms step_avg:373.58ms
step:442/500 train_loss:5.3833 train_time:161386ms step_avg:373.58ms
step:443/500 train_loss:5.3376 train_time:161759ms step_avg:373.58ms
step:444/500 train_loss:5.2471 train_time:162132ms step_avg:373.57ms
step:445/500 train_loss:5.4476 train_time:162505ms step_avg:373.57ms
step:446/500 train_loss:5.3536 train_time:162878ms step_avg:373.57ms
step:447/500 train_loss:5.3731 train_time:163251ms step_avg:373.57ms
step:448/500 train_loss:5.3147 train_time:163624ms step_avg:373.57ms
step:449/500 train_loss:5.3729 train_time:163998ms step_avg:373.57ms
step:450/500 train_loss:5.2171 train_time:164371ms step_avg:373.57ms
step:451/500 train_loss:5.2304 train_time:164744ms step_avg:373.57ms
step:452/500 train_loss:5.1526 train_time:165117ms step_avg:373.57ms
step:453/500 train_loss:5.2485 train_time:165490ms step_avg:373.57ms
step:454/500 train_loss:5.2017 train_time:165864ms step_avg:373.57ms
step:455/500 train_loss:5.2772 train_time:166238ms step_avg:373.57ms
step:456/500 train_loss:5.3929 train_time:166611ms step_avg:373.57ms
step:457/500 train_loss:5.2578 train_time:166984ms step_avg:373.57ms
step:458/500 train_loss:5.3793 train_time:167357ms step_avg:373.57ms
step:459/500 train_loss:5.3892 train_time:167731ms step_avg:373.57ms
step:460/500 train_loss:5.1590 train_time:168105ms step_avg:373.57ms
step:461/500 train_loss:5.3284 train_time:168476ms step_avg:373.56ms
step:462/500 train_loss:5.3185 train_time:168851ms step_avg:373.56ms
step:463/500 train_loss:5.1951 train_time:169224ms step_avg:373.56ms
step:464/500 train_loss:5.3797 train_time:169597ms step_avg:373.56ms
step:465/500 train_loss:5.2865 train_time:169971ms step_avg:373.56ms
step:466/500 train_loss:5.2931 train_time:170343ms step_avg:373.56ms
step:467/500 train_loss:5.4652 train_time:170717ms step_avg:373.56ms
step:468/500 train_loss:5.4555 train_time:171090ms step_avg:373.56ms
step:469/500 train_loss:5.3518 train_time:171463ms step_avg:373.56ms
step:470/500 train_loss:5.3065 train_time:171836ms step_avg:373.56ms
step:471/500 train_loss:5.3821 train_time:172211ms step_avg:373.56ms
step:472/500 train_loss:5.3927 train_time:172585ms step_avg:373.56ms
step:473/500 train_loss:5.2763 train_time:172959ms step_avg:373.56ms
step:474/500 train_loss:5.2917 train_time:173332ms step_avg:373.56ms
step:475/500 train_loss:5.1704 train_time:173706ms step_avg:373.56ms
step:476/500 train_loss:5.5937 train_time:174080ms step_avg:373.56ms
step:477/500 train_loss:5.3355 train_time:174453ms step_avg:373.56ms
step:478/500 train_loss:5.2709 train_time:174827ms step_avg:373.56ms
step:479/500 train_loss:5.2673 train_time:175200ms step_avg:373.56ms
step:480/500 train_loss:5.3010 train_time:175574ms step_avg:373.56ms
step:481/500 train_loss:5.4016 train_time:175947ms step_avg:373.56ms
step:482/500 train_loss:5.2675 train_time:176321ms step_avg:373.56ms
step:483/500 train_loss:5.1163 train_time:176695ms step_avg:373.56ms
step:484/500 train_loss:5.3430 train_time:177068ms step_avg:373.56ms
step:485/500 train_loss:5.2664 train_time:177441ms step_avg:373.56ms
step:486/500 train_loss:5.2982 train_time:177814ms step_avg:373.56ms
step:487/500 train_loss:5.2943 train_time:178187ms step_avg:373.56ms
step:488/500 train_loss:5.1917 train_time:178560ms step_avg:373.56ms
step:489/500 train_loss:5.4336 train_time:178933ms step_avg:373.56ms
step:490/500 train_loss:5.3015 train_time:179305ms step_avg:373.55ms
step:491/500 train_loss:5.2354 train_time:179679ms step_avg:373.55ms
step:492/500 train_loss:5.1864 train_time:180053ms step_avg:373.55ms
step:493/500 train_loss:5.3170 train_time:180426ms step_avg:373.55ms
step:494/500 train_loss:5.1680 train_time:180799ms step_avg:373.55ms
step:495/500 train_loss:5.2940 train_time:181173ms step_avg:373.55ms
step:496/500 train_loss:5.2095 train_time:181545ms step_avg:373.55ms
step:497/500 train_loss:5.3301 train_time:181919ms step_avg:373.55ms
step:498/500 train_loss:5.3136 train_time:182293ms step_avg:373.55ms
step:499/500 train_loss:5.4352 train_time:182665ms step_avg:373.55ms
step:500/500 train_loss:5.4828 train_time:183039ms step_avg:373.55ms
step:500/500 val_loss:5.3202 train_time:183040ms step_avg:373.55ms

====================================================================================================
FINAL RESULTS
====================================================================================================
Peak memory consumption: 30554 MiB
Final training loss: 5.4828
Final validation loss: 5.3202
Total training time: 183040 ms (183.04 s)
